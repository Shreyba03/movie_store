{% extends "base.html" %}
{% block content %}
  <h1>{{ movie.title }}</h1>
  <p><strong>Price:</strong> ${{ movie.price }}</p>
  <p>{{ movie.description }}</p>

  {% if movie.image %}
    <img src="{{ movie.image.url }}" alt="{{ movie.title }}" width="200">
  {% endif %}

  <h2>Reviews</h2>
  {% if reviews %}
    <ul>
      {% for review in reviews %}
        <li>
          {{ review.content }} â€” <em>{{ review.user.username }}</em>
          {% if review.user == user %}
            | <a href="{% url 'review_edit' review.id %}">Edit</a>
            | <a href="{% url 'review_delete' review.id %}">Delete</a>
          {% endif %}
        </li>
      {% endfor %}
    </ul>
  {% else %}
    <p>No reviews yet.</p>
  {% endif %}

  {% if user.is_authenticated %}
    {% if user_review %}
      <p>You have already reviewed this movie. You can <a href="{% url 'review_edit' user_review.id %}">edit</a> or <a href="{% url 'review_delete' user_review.id %}">delete</a> your review.</p>
    {% else %}
      <h3>Add a Review</h3>
      <form method="post" action="{% url 'review_create' movie.pk %}">
        {% csrf_token %}
        <div>
          <label for="content">Your Review:</label>
          <textarea name="content" id="content" rows="4" cols="50" required></textarea>
        </div>
        <button type="submit">Add Review</button>
      </form>
    {% endif %}
  {% else %}
    <p><a href="{% url 'login' %}">Login</a> to add a review.</p>
  {% endif %}
{% endblock %}